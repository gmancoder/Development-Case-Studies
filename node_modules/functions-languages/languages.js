var dynamics = require('services-dynamics');

function GetLanguages(token)
{
	if(token != "")
	{
		var data = {'entity': 'gb_developmentcasestudylanguagecategory', 'fields': ['gb_name', 'gb_foldername', 'gb_syntaxhighlighterbrush']};
		return dynamics.PostToDynamics(token, 'retrieve', data).then(function(body) {
			var types = [];
			var results = body.results.entities;
			for(ridx = 0; ridx < results.length; ridx ++)
			{
				var result = results[ridx];
				console.log(result);
				var name = "";
				var id = result.id;
				var folder = "";
				var highligher = "";
				for(var aidx = 0; aidx < result.attributes.length; aidx ++)
				{
					var attrib = result.attributes[aidx];
					if(attrib.key == "gb_name") {
						name = attrib.value;
					}
					else if(attrib.key == "gb_foldername") {
						folder = attrib.value;
					}
					else if(attrib.key == "gb_syntaxhighlighterbrush") {
						highligher = attrib.value;
					}
				}

				types.push({'ID': id, 'Title': name, 'Folder': folder, 'Brush': highligher});
			}

			return types;
		});
	}
}

module.exports = {
	GetLanguages: GetLanguages
};