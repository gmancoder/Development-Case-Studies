var dynamics = require('services-dynamics');
var gallery = require('services-gallery');
function GetStudiesByType(token, id)
{
	if(token != "")
	{
		var data = {'entity': 'gb_developmentcasestudy', 'fields': ['gb_name', 'gb_thumbnailurl'], 'conditions': [{'field': 'gb_languagecategory', 'operator': 'Equals', 'values': [id]}], 'order': ['gb_name']};
		return dynamics.PostToDynamics(token, 'retrieve', data).then(function(body) {
			var studies = [];
			for(var idx = 0; idx < body.results.entities.length; idx ++) {
				var entity = body.results.entities[idx];
				var title = "";
				var thumbnail = "";
				var id = entity.id;
				for(var aidx = 0; aidx < entity.attributes.length; aidx ++)
				{
					var attrib = entity.attributes[aidx];
					if(attrib.key == 'gb_name') {
						title = attrib.value;
					}
					else if(attrib.key == 'gb_thumbnailurl') {
						thumbnail = attrib.value;
					}
				}
				var study = {'title': title, 'id': id, 'thumb': thumbnail}
				studies.push(study);
			}
			console.log(studies);
			return studies;
		});
	}
}

module.exports = {
	GetStudiesByType: GetStudiesByType
};